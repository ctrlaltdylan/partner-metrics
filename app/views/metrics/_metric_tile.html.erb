<% current_value = metrics.calculate_value(current_user, tile) %>
<% current_change = metrics.calculate_change(current_user, tile, previous_metrics) %>

<div>
  <%= polaris_card(
    title: tile["title"],
    actions: [{
      content: polaris_icon(name: "AnalyticsLineMinor"),
      title: "View chart",
      url: chart_url,
      data: {
        turbo_frame: "metrics",
        turbo_action: "advance",
      },
    }]
  ) do %>
      <%= polaris_stack(alignment: :center) do |stack| %>

        <% stack.with_item(fill: true) do %>
          <%= polaris_text(variant: :heading2xl, as: :h2) do %>
            <%= metric_display_value(tile["display"], current_value)%>
          <% end %>
        <% end %>

        <% stack.with_item do %>
          <%= polaris_text(
            variant: :headingMd,
            as: :h3,
            color: metric_change_color(current_change, tile["direction_good"])
          ) do %>
            <%= number_to_percentage_with_precision(current_change) %>
          <% end %>
          <%= polaris_text(variant: :bodySm, alignment: :end, color: :subdued) do %>
            <%= pluralize(q[:period], 'day') %> ago
          <% end %>
        <% end %>

    <% end %>
  <% end %>
</div>
