<%= polaris_page(
  title: t(".#{@filter.charge_type}.title"),
  subtitle: t(".#{@filter.charge_type}.subtitle"),
) do |page| %>

  <%= turbo_frame_tag :metrics do %>

    <%= polaris_vertical_stack(gap: "5") do %>

      <%= render "filter", filter: @filter, app_titles: @app_titles %>

      <% if @filter.has_metrics? %>

          <%= render "tile_with_chart", tile: @selected_tile, filter: @filter %>

          <%= polaris_horizontal_grid(gap: "5", columns: 3) do %>
            <% @tiles.each do |tile| %>
              <%= render "tile", tile: tile, filter: @filter %>
            <% end %>
          <% end %>

          <%#= render "#{params[:controller]}/revenue_per", q: current_query %>

      <% else %>

        <%= render "metrics/empty_state", heading: t(".#{@filter.charge_type}.title"), icon_name: "AnalyticsMajor" %>

      <% end %>

    <% end %>

    <%= polaris_card do %>
      <%= turbo_frame_tag current_user do %>
        <%= form_with(
          model: current_user,
          builder: Polaris::FormBuilder,
        ) do |form| %>

          <%= polaris_form_layout do |form_layout| %>

            <% if current_user.errors.any? %>
              <% form_layout.item do %>
                <%= form.errors_summary %>
              <% end %>
            <% end %>

            <% form_layout.with_item do %>
              <%= form.file_field :import_file, required: current_user.metrics.none? %>
            <% end %>

            <% form_layout.with_item do %>
              <%= polaris_button(
                submit: true,
                primary: true,
                data: {form_target: "submitButton"},
              ) { "Save" } %>
            <% end %>

          <% end %>

        <% end %>
      <% end %>
    <% end %>

  <% end %>

<% end %>
